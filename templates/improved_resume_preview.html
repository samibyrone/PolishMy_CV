<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Improved - Polish My CV (v2)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --notion-bg: #ffffff;
            --notion-text: #37352f;
            --notion-text-light: #787774;
            --notion-border: #e9e9e7;
            --notion-hover: #f7f6f3;
            --notion-blue: #2383e2;
            --notion-green: #0f7b0f;
            --notion-red: #e03e3e;
            --notion-yellow: #dfab01;
            --notion-purple: #9065b0;
            --notion-sidebar: #f7f6f3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, 'Apple Color Emoji', Arial, sans-serif, 'Segoe UI Emoji', 'Segoe UI Symbol';
            background-color: var(--notion-bg);
            color: var(--notion-text);
            line-height: 1.5;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background-color: var(--notion-sidebar);
            border-right: 1px solid var(--notion-border);
            padding: 24px 16px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .brand-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--notion-border);
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(35, 131, 226, 0.1);
            border-radius: 8px;
        }

        .brand-text {
            flex: 1;
        }

        .brand-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--notion-text);
            margin-bottom: 2px;
        }

        .brand-tagline {
            font-size: 11px;
            color: var(--notion-text-light);
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .sidebar-header {
            margin-bottom: 32px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--notion-text);
            margin-bottom: 8px;
        }

        .sidebar-subtitle {
            font-size: 12px;
            color: var(--notion-text-light);
        }

        .score-section {
            background: white;
            border: 1px solid var(--notion-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .score-header {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--notion-text);
        }

        .score-comparison {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .score-item {
            flex: 1;
            text-align: center;
        }

        .score-label {
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            color: var(--notion-text-light);
            margin-bottom: 4px;
        }

        .score-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .score-original {
            color: var(--notion-red);
        }

        .score-improved {
            color: var(--notion-green);
        }

        .score-improvement {
            font-size: 12px;
            color: var(--notion-green);
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-notion {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border: 1px solid var(--notion-border);
            border-radius: 6px;
            background: white;
            color: var(--notion-text);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
        }

        .btn-notion:hover {
            background: var(--notion-hover);
            color: var(--notion-text);
            text-decoration: none;
        }

        .btn-notion.primary {
            background: var(--notion-blue);
            color: white;
            border-color: var(--notion-blue);
        }

        .btn-notion.primary:hover {
            background: #1a6bb8;
            color: white;
        }

        .btn-notion.success {
            background: var(--notion-green);
            color: white;
            border-color: var(--notion-green);
        }

        .btn-notion.success:hover {
            background: #0d6a0d;
            color: white;
        }

        .content-area {
            flex: 1;
            margin-left: 280px;
            padding: 24px;
        }

        .content-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--notion-text);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: var(--notion-text-light);
        }

        .preview-container {
            background: white;
            border: 1px solid var(--notion-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-tabs {
            display: flex;
            border-bottom: 1px solid var(--notion-border);
            background: var(--notion-sidebar);
        }

        .preview-tab {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--notion-text-light);
            cursor: pointer;
            border: none;
            background: none;
            transition: all 0.15s ease;
        }

        .preview-tab.active {
            color: var(--notion-text);
            background: white;
            border-bottom: 2px solid var(--notion-blue);
        }

        .preview-tab:hover:not(.active) {
            color: var(--notion-text);
            background: var(--notion-hover);
        }

        .preview-content {
            height: 80vh;
            position: relative;
        }

        .tab-pane {
            display: none;
            height: 100%;
        }

        .tab-pane.active {
            display: block;
        }

        .pdf-viewer {
            width: 100%;
            height: 100%;
            border: none;
            background: #f5f5f5;
        }

        .pdf-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #f5f5f5;
            color: var(--notion-text-light);
        }

        .latex-viewer {
            height: 100%;
            overflow: auto;
            padding: 24px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            background: #f8f9fa;
        }

        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            flex-direction: column;
            gap: 16px;
            color: var(--notion-text-light);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--notion-border);
            border-top: 3px solid var(--notion-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-success {
            background: rgba(15, 123, 15, 0.1);
            color: var(--notion-green);
        }

        .status-warning {
            background: rgba(223, 171, 1, 0.1);
            color: var(--notion-yellow);
        }

        .improvement-summary {
            background: white;
            border: 1px solid var(--notion-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .improvement-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--notion-text);
        }

        .improvement-list {
            list-style: none;
            padding: 0;
        }

        .improvement-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid var(--notion-border);
        }

        .improvement-item:last-child {
            border-bottom: none;
        }

        .improvement-icon {
            color: var(--notion-green);
            margin-top: 2px;
        }

        .improvement-text {
            font-size: 14px;
            color: var(--notion-text);
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }

            .content-area {
                margin-left: 0;
            }

            .score-comparison {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Polish My CV Branding -->
            <div class="brand-header">
                <div class="brand-logo">
                    <i class="fas fa-file-alt" style="color: var(--notion-blue); font-size: 24px;"></i>
                </div>
                <div class="brand-text">
                    <div class="brand-name">Polish My CV</div>
                    <div class="brand-tagline">AI-Powered Resume Enhancement</div>
                </div>
            </div>
            
            <div class="sidebar-header">
                <div class="sidebar-title">Resume Improvement</div>
                <div class="sidebar-subtitle">Your CV has been enhanced</div>
            </div>

            <!-- Score Section -->
            <div class="score-section">
                <div class="score-header">
                    <i class="fas fa-chart-line"></i> Performance Score
                </div>
                <div class="score-comparison">
                    <div class="score-item">
                        <div class="score-label">Before</div>
                        <div class="score-value score-original">{{ original_score }}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">After</div>
                        <div class="score-value score-improved">{{ new_score|default(improved_score|default(85)) }}</div>
                    </div>
                </div>
                {% if (new_score|default(improved_score|default(85)))|int > original_score|int %}
                <div class="score-improvement">
                    <i class="fas fa-arrow-up"></i> +{{ (new_score|default(improved_score|default(85)))|int - original_score|int }} points improvement
                </div>
                {% endif %}
            </div>

            <!-- Improvement Summary -->
            <div class="improvement-summary">
                <div class="improvement-title">Key Improvements</div>
                <ul class="improvement-list">
                    <li class="improvement-item">
                        <i class="fas fa-check improvement-icon"></i>
                        <span class="improvement-text">Enhanced professional summary</span>
                    </li>
                    <li class="improvement-item">
                        <i class="fas fa-check improvement-icon"></i>
                        <span class="improvement-text">Quantified achievements</span>
                    </li>
                    <li class="improvement-item">
                        <i class="fas fa-check improvement-icon"></i>
                        <span class="improvement-text">Optimized keywords</span>
                    </li>
                    <li class="improvement-item">
                        <i class="fas fa-check improvement-icon"></i>
                        <span class="improvement-text">Improved formatting</span>
                    </li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                {% if pdf_available %}
                <a href="/download-improved/{{ session_id }}/{{ pdf_filename }}" class="btn-notion primary">
                    <i class="fas fa-download"></i>
                    Download PDF
                </a>
                {% endif %}
                
                <a href="/download-improved/{{ session_id }}/{{ latex_filename }}" class="btn-notion">
                    <i class="fas fa-code"></i>
                    Download LaTeX
                </a>
                
                <a href="/" class="btn-notion">
                    <i class="fas fa-plus"></i>
                    Improve Another CV
                </a>
                
                <button onclick="window.history.back()" class="btn-notion">
                    <i class="fas fa-arrow-left"></i>
                    Back to Review
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-area">
            <div class="content-header">
                <h1 class="page-title">
                    <i class="fas fa-sparkles" style="color: var(--notion-yellow);"></i>
                    Resume Improved
                </h1>
                <p class="page-subtitle">
                    Your resume has been enhanced with AI-powered improvements. 
                    {% if pdf_available %}
                    <span class="status-badge status-success">
                        <i class="fas fa-check-circle"></i>
                        PDF Ready
                    </span>
                    {% else %}
                    <span class="status-badge status-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        LaTeX Only
                    </span>
                    {% endif %}
                </p>
            </div>

            <!-- Preview Container -->
            <div class="preview-container">
                <div class="preview-tabs">
                    {% if pdf_available %}
                    <button class="preview-tab active" onclick="switchTab('pdf')">
                        <i class="fas fa-file-pdf"></i> PDF Preview
                    </button>
                    {% endif %}
                    <button class="preview-tab {% if not pdf_available %}active{% endif %}" onclick="switchTab('latex')">
                        <i class="fas fa-code"></i> LaTeX Source
                    </button>
                </div>

                <div class="preview-content">
                    {% if pdf_available %}
                    <div id="pdf-tab" class="tab-pane active">
                        <div class="pdf-loading" id="pdf-loading">
                            <div class="spinner"></div>
                            <div style="margin-left: 12px;">Loading PDF preview...</div>
                        </div>
                        <iframe 
                            src="/view-improved/{{ session_id }}/{{ pdf_filename }}#toolbar=1&navpanes=0&scrollbar=1" 
                            class="pdf-viewer"
                            title="Improved Resume PDF Preview"
                            style="display: none;"
                            onload="hidePdfLoading()">
                        </iframe>
                    </div>
                    {% endif %}

                    <div id="latex-tab" class="tab-pane {% if not pdf_available %}active{% endif %}">
                        <div class="loading-state" id="latex-loading">
                            <div class="spinner"></div>
                            <div>Loading LaTeX source...</div>
                        </div>
                        <pre id="latex-content" class="latex-viewer" style="display: none;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.preview-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');

            // Load LaTeX content if switching to LaTeX tab
            if (tabName === 'latex') {
                loadLatexContent();
            }
        }

        function loadLatexContent() {
            const latexContent = document.getElementById('latex-content');
            const latexLoading = document.getElementById('latex-loading');
            
            if (latexContent.textContent.trim() === '') {
                fetch('/view-improved/{{ session_id }}/{{ latex_filename }}')
                    .then(response => response.text())
                    .then(data => {
                        latexContent.textContent = data;
                        latexLoading.style.display = 'none';
                        latexContent.style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error loading LaTeX:', error);
                        latexContent.textContent = 'Error loading LaTeX content.';
                        latexLoading.style.display = 'none';
                        latexContent.style.display = 'block';
                    });
            } else {
                latexLoading.style.display = 'none';
                latexContent.style.display = 'block';
            }
        }

        // Load LaTeX content on page load if it's the active tab
        document.addEventListener('DOMContentLoaded', function() {
            {% if not pdf_available %}
            loadLatexContent();
            {% endif %}
        });

        // Function to hide PDF loading state
        function hidePdfLoading() {
            const pdfLoading = document.getElementById('pdf-loading');
            const pdfViewer = document.querySelector('.pdf-viewer');
            
            if (pdfLoading) {
                pdfLoading.style.display = 'none';
            }
            if (pdfViewer) {
                pdfViewer.style.display = 'block';
            }
        }

        // Add smooth scrolling and animations
        document.addEventListener('DOMContentLoaded', function() {
            // Animate score values
            const scoreValues = document.querySelectorAll('.score-value');
            scoreValues.forEach(score => {
                const finalValue = parseInt(score.textContent);
                let currentValue = 0;
                const increment = finalValue / 30;
                
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        score.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        score.textContent = Math.floor(currentValue);
                    }
                }, 50);
            });
        });
    </script>
</body>
</html> 